// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model SuperAdmin {
  id           String      @id @unique @default(uuid())
  adminName    String?
  adminEmail   String?     @unique
  phone        String?
  password     String?
  profileImage String?
  status       AdminStatus @default(ACTIVE)
  google_id    String?     @unique
  is2FA        Boolean?    @default(false)
  isLocked     Boolean?    @default(false)
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
}

model SystemFeature {
  id          String   @id @default(uuid())
  name        String   @unique
  description String?  @db.Text
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // ðŸ”¹ Relation with Admin
  admins AdminFeature[]
}

model DemoRequest {
  id                 Int      @id @default(autoincrement())
  fullName           String
  email              String
  phone              String
  companyName        String
  companyWebsite     String? // Optional
  companyDescription String? // Optional
  companySize        String?
  message            String?
  status             String   @default("pending") // New field for approval status
  createdAt          DateTime @default(now())
}

model AdminFeature {
  adminId   String
  featureId String
  createdAt DateTime @default(now())

  admin   Admin         @relation(fields: [adminId], references: [id], onDelete: Cascade)
  feature SystemFeature @relation(fields: [featureId], references: [id], onDelete: Cascade)

  @@id([adminId, featureId])
}

model Admin {
  id           String      @id @unique @default(uuid())
  adminName    String?
  adminEmail   String?     @unique
  phone        String?
  password     String?
  profileImage String?
  status       AdminStatus @default(ACTIVE)
  google_id    String?     @unique
  website      String?
  address      String?
  city         String?
  country      String?
  description  String?

  message          String?
  messageExpiry    DateTime?
  isMessage        Boolean?  @default(false)
  messageTextColor String?
  messageBgColor   String?

  is2FA     Boolean? @default(false)
  isLocked  Boolean? @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  medications           Medication[]
  requestedBy           Request[]      @relation("RequestedByAdmin")
  closedBy              Request[]      @relation("ClosedByAdmin")
  issuedBy              Request[]      @relation("IssuedByAdmin")
  rejectedBy            Request[]      @relation("rejectedByAdmin")
  stockHistoriesCreated StockHistory[]
  Activity              Activity[]
  category              Category[]
  client                Client[]
  suppliers             Supplier[]
  expenses              Expense[]
  store                 Store[]
  employee              Employee[]

  stockout StockOut[]

  // ðŸ”¹ Relation with SystemFeature
  features AdminFeature[]

  Stock Stock[]

  membershipPlans MembershipPlan[]

  // ðŸ”¥ Purchase Order & GRN Relations
  purchaseOrdersCreated  PurchaseOrder[]      @relation("POCreatedByAdmin")
  purchaseOrdersApproved PurchaseOrder[]      @relation("POApprovedByAdmin")
  grnsReceived           GoodsReceivingNote[] @relation("GRNReceivedByAdmin")
  grnsApproved           GoodsReceivingNote[] @relation("GRNApprovedByAdmin")
  approvalsRequested     ApprovalWorkflow[]   @relation("ApprovalRequestedByAdmin")
  approvalsApproved      ApprovalWorkflow[]   @relation("ApprovalApprovedByAdmin")
  documentsUploaded      DocumentAttachment[] @relation("DocUploadedByAdmin")
  alertsAcknowledged     AlertNotification[]  @relation("AlertAcknowledgedByAdmin")
  debitsCreated          Debit[]

}

enum AdminStatus {
  ACTIVE
  INACTIVE
}

model MembershipPlan {
  id               String   @id @default(uuid())
  companyId        String
  planName         String
  startTime        DateTime
  expireTime       DateTime
  amountPaid       Float
  shortDescription String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  company Admin @relation(fields: [companyId], references: [id], onDelete: Cascade)

  @@index([companyId])
}

// Define the enum first
enum EmployeeStatus {
  ACTIVE
  TERMINATED
  RESIGNED
  PROBATION
}

model Employee {
  id                      String         @id @unique @default(uuid())
  first_name              String?
  last_name               String?
  gender                  String?
  phone                   String?
  email                   String         @unique
  password                String?
  national_id             String?        @unique
  profile_picture         String?
  position                String?
  department              String?
  date_hired              DateTime?
  status                  EmployeeStatus @default(ACTIVE)
  emergency_contact_name  String?
  emergency_contact_phone String?
  store                   Store[]
  adminId                 String
  admin                   Admin          @relation(fields: [adminId], references: [id])
  // security
  google_id               String?        @unique
  isLocked                Boolean?       @default(false)
  is2FA                   Boolean?       @default(false)

  category        Category[]
  activity        Activity[]
  contract        Contract[]
  managedSites    Site[]       @relation("ManagerRelation")
  supervisedSites Site[]       @relation("SupervisorRelation")
  medications     Medication[]
  feeds           FeedCage[]

  eggToPondMigration EggToPondMigration[]
  // Assigned site (one site only)
  siteId             String?
  site               Site?                @relation("SiteEmployees", fields: [siteId], references: [id], onDelete: SetNull, onUpdate: Cascade)

  // ðŸ”¹ Requests
  requestedBy Request[] @relation("RequestedByEmployee")
  closedBy    Request[] @relation("ClosedByEmployee")
  issuedBy    Request[] @relation("IssuedByEmployee")
  rejectedBy  Request[] @relation("rejectedByEmployee")

  // ðŸ”¹ StockHistory
  stockHistoriesCreated StockHistory[]
  parentFishPools       ParentFishPool[]
  parentWaterChanging   ParentWaterChanging[]
  parentEggMigration    ParentEggMigration[]
  eggFishFeeding        EggFishFeeding[]

  grownEggPondFeeding GrownEggPondFeeding[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  AssetRequest AssetRequest[]

  ParentFishFeeding          ParentFishFeeding[]
  medicines                  Medicine[]
  stockout                   StockOut[]
  ParentFishMedication       ParentFishMedication[]
  EggFishMedication          EggFishMedication[]
  laboratoryBoxWaterChanging LaboratoryBoxWaterChanging[]
  PondWaterChanging          PondWaterChanging[]
  PondMedication             PondMedication[]

  // ðŸ”¥ Purchase Order & GRN Relations
  purchaseOrdersCreated  PurchaseOrder[]      @relation("POCreatedByEmployee")
  purchaseOrdersApproved PurchaseOrder[]      @relation("POApprovedByEmployee")
  grnsReceived           GoodsReceivingNote[] @relation("GRNReceivedByEmployee")
  grnsApproved           GoodsReceivingNote[] @relation("GRNApprovedByEmployee")
  approvalsRequested     ApprovalWorkflow[]   @relation("ApprovalRequestedByEmployee")
  approvalsApproved      ApprovalWorkflow[]   @relation("ApprovalApprovedByEmployee")
  documentsUploaded      DocumentAttachment[] @relation("DocUploadedByEmployee")
  alertsAcknowledged     AlertNotification[]  @relation("AlertAcknowledgedByEmployee")
  stockLocationsManaged  StockLocation[]
  debitsCreated          Debit[]
}

model Contract {
  id                    String       @id @default(uuid())
  employeeId            String?
  employee              Employee?    @relation(fields: [employeeId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  contractType          ContractType
  startDate             DateTime
  endDate               DateTime?
  salary                Float
  currency              String       @default("RWF")
  benefits              String? // e.g., health insurance, PTO
  workingHours          String? // e.g., "40 hours/week"
  probationPeriod       String? // e.g., "3 months"
  terminationConditions String?
  terms                 String? // General terms text
  createdAt             DateTime     @default(now())
  updatedAt             DateTime     @updatedAt
}

enum ContractType {
  PERMANENT
  TEMPORARY
  INTERNSHIP
}

model Stock {
  id       Int    @id @default(autoincrement())
  sku      String @unique // SKU / Item Code â€“ unique identifier
  itemName String // Item Name â€“ product name or description

  // Category relation (optional)
  categoryId String? // FK to Category.id (String)
  category   Category? @relation(fields: [categoryId], references: [id])

  // Supplier is flexible optional text (not a strict FK)
  supplier String? // Supplier â€“ optional, not a foreign key (can be text)

  unitOfMeasure    String // Unit of Measure â€“ e.g., pcs, box, kg, liter
  receivedQuantity Int // Received Quantity â€“ how many units were received

  // Monetary values stored as Decimal for safety
  unitCost   Decimal @db.Decimal(12, 2) // Unit Cost â€“ cost per unit
  totalValue Decimal @db.Decimal(14, 2) // Total Value â€“ (Received Quantity Ã— Unit Cost)

  warehouseLocation String // Warehouse Location â€“ where the item is stored
  receivedDate      DateTime // Received Date â€“ when it arrived
  reorderLevel      Int // Reorder Level â€“ stock level that triggers reordering
  expiryDate        DateTime? // Expiry Date â€“ optional product expiration

  // Admin foreign key (matches Admin.id which is String)
  adminId String
  admin   Admin  @relation(fields: [adminId], references: [id])

  stockout     StockOut[]
  stockhistory StockHistory[]
 

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([sku])
}

model Job {
  id               String          @id @default(uuid())
  title            String
  description      String?         @db.Text
  location         String
  employment_type  EmploymentType
  experience_level ExperienceLevel
  industry         String?

  skills_required Json
  status          JobStatus @default(OPEN)

  posted_at   DateTime? @default(now())
  expiry_date DateTime?

  applicants Applicant[]

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt
}

enum EmploymentType {
  FULL_TIME
  PART_TIME
  CONTRACT
  INTERNSHIP
}

enum ExperienceLevel {
  ENTRY
  MID
  SENIOR
  EXECUTIVE
}

enum JobStatus {
  OPEN
  CLOSED
}

enum ApplicationStage {
  APPLIED
  SHORTLISTED
  INTERVIEWED
  HIRED
  REJECTED
}

model Applicant {
  id    String @id @default(uuid())
  jobId String // FK â†’ Job.id
  job   Job    @relation(fields: [jobId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  name            String
  email           String
  phone           String?
  cvUrl           String? // link to uploaded CV
  skills          Json? // array of candidateâ€™s skills
  experienceYears Int? // number of years experience
  education       Json? // [{ degree: "BSc CS", school: "XYZ", year: 2023 }]
  coverLetter     String?   @db.Text
  start_date      DateTime?

  stage ApplicationStage @default(APPLIED)

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt
}

model Client {
  id           String       @id @default(uuid())
  firstname    String
  lastname     String
  email        String
  phone        String?
  address      String?
  status       ClientStatus @default(ACTIVE)
  profileImage String? // store URL or file path

  adminId   String?
  admin     Admin?   @relation(fields: [adminId], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum ClientStatus {
  ACTIVE
  INACTIVE
}

enum DebitStatus {
  PENDING
  PARTIALLY_PAID
  PAID
  CANCELLED
}

model Debit {
  id          String   @id @default(cuid())

  description String?   // What this debit is for
  totalAmount Float     // Total amount that must be paid

  stockOutId  String?
  stockOut    StockOut? @relation(fields: [stockOutId], references: [id])

  // JSON array of payments made toward this debit
  // Example:
  // [
  //   { "amount": 3000, "paidAt": "2026-01-23T10:00:00.000Z" }
  // ]
  payments    Json?

  status      DebitStatus @default(PENDING)
  
    adminId   String?
  admin     Admin?   @relation(fields: [adminId], references: [id])

  employeeId  String?
  employee    Employee? @relation(fields: [employeeId], references: [id], onDelete: SetNull)

  createdAt   DateTime @default(now())
}


model Activity {
  id          Int       @id @default(autoincrement())
  title       String
  description String?
  dueDate     DateTime?
  createdAt   DateTime  @default(now())

  adminId    String? // must match Admin.id type
  employeeId String?

  admin    Admin?    @relation(fields: [adminId], references: [id])
  employee Employee? @relation(fields: [employeeId], references: [id])
}

model Asset {
  id          String        @id @default(uuid())
  name        String
  category    AssetCategory // Machinery, Vehicle, Building, etc.
  description String?
  assetImg    String?
  location    String?
  quantity    String

  // Financial
  purchaseDate DateTime?
  purchaseCost Float?

  // Status & tracking
  status    AssetStatus @default(ACTIVE)
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt

  AssetRequestItem AssetRequestItem[]
}

enum AssetCategory {
  MACHINERY
  VEHICLE
  BUILDING
  EQUIPMENT
  SOFTWARE
  OTHER
}

enum AssetStatus {
  ACTIVE
  MAINTENANCE
  RETIRED
  DISPOSED
}

model Store {
  id          String  @id @default(uuid())
  code        String  @unique
  name        String
  location    String
  description String? @db.Text

  managerId String?
  manager   Employee? @relation(fields: [managerId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  adminId String
  admin   Admin  @relation(fields: [adminId], references: [id])

  contact_phone String?
  contact_email String?
  stockins      StockIn[]
  created_at    DateTime  @default(now())
  updated_at    DateTime  @updatedAt
}

model Site {
  id           String  @id @default(uuid())
  siteCode     String  @unique
  name         String
  location     String
  siteImg      String?
  managerId    String?
  supervisorId String?

  //relations
  manager    Employee?  @relation("ManagerRelation", fields: [managerId], references: [id], onDelete: Cascade, onUpdate: Cascade, map: "Site_manager_fkey")
  supervisor Employee?  @relation("SupervisorRelation", fields: [supervisorId], references: [id], onDelete: Cascade, onUpdate: Cascade, map: "Site_supervisor_fkey")
  employees  Employee[] @relation("SiteEmployees")
  request    Request[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Cage {
  id           String      @id @default(uuid())
  cageCode     String      @unique
  cageName     String
  cageNetType  CageNetType // FINGERLING, JUVENILE, ADULT
  cageDepth    Float
  cageStatus   CageStatus
  cageCapacity Int
  cageType     String? // floating, fixed, submersible
  cageVolume   Float?
  stockingDate DateTime?

  //relations 
  Medication Medication[]
  feeds      FeedCage[]

  createdAt DateTime @default(now())
}

enum CageStatus {
  ACTIVE
  INACTIVE
  UNDER_MAINTENANCE
}

enum CageNetType {
  FINGERLING
  JUVENILE
  ADULT
}

model Medication {
  id        String           @id @default(uuid())
  name      String
  dosage    String
  method    MedicationMethod
  reason    String?
  startDate DateTime
  endDate   DateTime?

  cageId String
  cage   Cage   @relation(fields: [cageId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  administeredByEmployee String?
  employee               Employee? @relation(fields: [administeredByEmployee], references: [id], onDelete: Cascade, onUpdate: Cascade)

  administeredByAdmin String?
  admin               Admin?  @relation(fields: [administeredByAdmin], references: [id], onDelete: Cascade, onUpdate: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum MedicationMethod {
  FEED
  BATH
  WATER
  INJECTION
}

model FeedCage {
  id String @id @default(uuid())

  quantityGiven Float
  notes         String?

  cageId String
  cage   Cage   @relation(fields: [cageId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  feed   FeedStock @relation(fields: [feedId], references: [id])
  feedId String

  employeeId String?
  employee   Employee? @relation(fields: [employeeId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([cageId])
  @@index([employeeId])
}

enum FeedType {
  PELLET
  SEED
  FRUIT
  VEGETABLE
  INSECT
  OTHER
}

model StockCategory {
  id          String   @id @default(uuid())
  name        String   @unique
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relation: one category has many stock items
  stockins StockIn[]
}

model StockIn {
  id           String  @id @default(uuid())
  productName  String
  sku          String? @unique
  quantity     Int     @default(0)
  unit         Unit
  unitPrice    Decimal @db.Decimal(10, 2)
  reorderLevel Int?    @default(1)
  supplier     String?
  location     String?
  description  String?

  expiryDate DateTime?

  // ðŸ”¥ GRN & Batch Tracking
  grnItemId String?  @unique // Link to GRN item that created this stock
  grnItem   GRNItem? @relation("StockInGRNItem")

  batchNumber       String? // Batch/Lot tracking
  serialNumbers     Json? // Serial numbers for this stock entry
  manufacturingDate DateTime? // Manufacturing date

  // ðŸ”¥ Cost Management
  landedCost      Decimal?         @db.Decimal(10, 2) // Actual cost per unit after all charges
  valuationMethod ValuationMethod? @default(WEIGHTED_AVERAGE)

  // ðŸ”¥ Quality & Inspection
  inspectionStatus InspectionStatus? @default(APPROVED)
  qualityNotes     String?           @db.Text

  // Relation: belongs to a category
  stockcategoryId String
  stockcategory   StockCategory @relation(fields: [stockcategoryId], references: [id])

  // Relation: belongs to a store
  storeId String
  store   Store  @relation(fields: [storeId], references: [id])

  stockhistory StockHistory[]
  requestItems RequestItem[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([batchNumber])
}

enum Unit {
  PCS // pieces
  KG // kilograms
  LITERS // liters
  METER // meters
  BOX // boxes
  PACK // packs
  OTHER // fallback
}

// Stock Valuation Methods
enum ValuationMethod {
  FIFO // First In First Out
  LIFO // Last In First Out
  WEIGHTED_AVERAGE //Weighted Average Cost
}

model StockOut {
  id            String         @id @default(uuid())
  stockinId     Int?
  adminId       String?
  employeeId    String?
  transactionId String?
  quantity      Int            @default(0)
  soldPrice     Decimal?       @db.Decimal(10, 2)
  clientName    String?
  clientEmail   String?
  clientPhone   String?
  paymentMethod PaymentMethod?

  // External Items (Not in Inventory)
  externalItemName String?
  externalSku      String?

  // Relations

  stockin  Stock?    @relation(fields: [stockinId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  admin    Admin?    @relation(fields: [adminId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  employee Employee? @relation(fields: [employeeId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  salesReturnItems SalesReturnItem[]

   debits         Debit[]

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum PaymentMethod {
  MOMO
  CARD
  CASH
}

model SalesReturn {
  id            String            @id @default(uuid())
  transactionId String?
  creditnoteId  String?
  adminId       String
  reason        String?
  createdAt     DateTime          @default(now())
  items         SalesReturnItem[]
}

model SalesReturnItem {
  id            String @id @default(uuid())
  salesReturnId String
  stockoutId    String
  quantity      Int

  stockout    StockOut?   @relation(fields: [stockoutId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  salesReturn SalesReturn @relation(fields: [salesReturnId], references: [id], onDelete: Cascade, onUpdate: Cascade)
}

model Request {
  id     String @id @default(uuid()) // UUID primary key
  ref_no String @unique @db.VarChar(50)

  siteId String
  site   Site   @relation(fields: [siteId], references: [id])

  // ðŸ”¹ Requested by (can be Admin or Employee)
  requestedByAdminId    String?
  requestedByAdmin      Admin?    @relation("RequestedByAdmin", fields: [requestedByAdminId], references: [id])
  requestedByEmployeeId String?
  requestedByEmployee   Employee? @relation("RequestedByEmployee", fields: [requestedByEmployeeId], references: [id])

  status RequestStatus @default(PENDING)
  notes  String?       @db.Text

  // ðŸ”¹ Received by (Admin or Employee)
  receivedAt         DateTime?
  // ðŸ”¹ Closed by
  closedAt           DateTime?
  closedByAdminId    String?
  closedByAdmin      Admin?    @relation("ClosedByAdmin", fields: [closedByAdminId], references: [id])
  closedByEmployeeId String?
  closedByEmployee   Employee? @relation("ClosedByEmployee", fields: [closedByEmployeeId], references: [id])

  // ðŸ”¹ Issued by
  issuedAt           DateTime?
  issuedByAdminId    String?
  issuedByAdmin      Admin?    @relation("IssuedByAdmin", fields: [issuedByAdminId], references: [id])
  issuedByEmployeeId String?
  issuedByEmployee   Employee? @relation("IssuedByEmployee", fields: [issuedByEmployeeId], references: [id])

  rejectedAt           DateTime?
  rejectedByAdminId    String?
  rejectedByAdmin      Admin?    @relation("rejectedByAdmin", fields: [rejectedByAdminId], references: [id])
  rejectedByEmployeeId String?
  rejectedByEmployee   Employee? @relation("rejectedByEmployee", fields: [rejectedByEmployeeId], references: [id])

  comments Json?

  attachments Json? //  {"fileName":"string","fileUrl":"string","uploadedBy":"string","uploadedById":"string","uploadedAt":"string","description":"string"}[]

  // ðŸ”¹ Relations
  requestItems RequestItem[]
  stockhistory StockHistory[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model RequestItem {
  id String @id @default(uuid()) // UUID primary key

  requestId String
  request   Request @relation(fields: [requestId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  stockInId String
  stockIn   StockIn @relation(fields: [stockInId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  qtyRequested Decimal @db.Decimal(12, 3)

  qtyIssued    Decimal  @default(0) @db.Decimal(12, 3)
  qtyRemaining Decimal  @default(0) @db.Decimal(12, 3)
  qtyReceived  Decimal? @default(0) @db.Decimal(12, 3)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum RequestStatus {
  PENDING
  APPROVED
  PARTIALLY_ISSUED
  ISSUED
  REJECTED
  RECEIVED
  CLOSED
}

model AssetRequest {
  id          String        @id @default(uuid())
  employeeId  String
  status      RequestStatus @default(PENDING)
  description String?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  // Relations
  employee Employee           @relation(fields: [employeeId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  items    AssetRequestItem[]
}

model AssetRequestItem {
  id                String              @id @default(uuid())
  requestId         String
  assetId           String
  quantity          Int                 @default(1)
  quantityIssued    Int?                @default(0)
  status            RequestedItemStatus @default(PENDING)
  procurementStatus ProcurementStatus   @default(NOT_REQUIRED)
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt

  // Relations
  request AssetRequest @relation(fields: [requestId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  asset   Asset        @relation(fields: [assetId], references: [id], onDelete: Cascade, onUpdate: Cascade)
}

enum RequestedItemStatus {
  PENDING
  ISSUED
  PARTIALLY_ISSUED
  PENDING_PROCUREMENT
}

enum ProcurementStatus {
  NOT_REQUIRED
  REQUIRED
  ORDERED
  PARTIALLY_ORDERED
  COMPLETED
}

enum MovementType {
  IN
  OUT
  ADJUSTMENT
}

enum SourceType {
  GRN
  ISSUE
  ADJUSTMENT
  RECEIPT
}

model StockHistory {
  id String @id @default(uuid())

  stockInId String?
  stockIn   StockIn? @relation(fields: [stockInId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  stockId Int?
  stock   Stock? @relation(fields: [stockId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  // ðŸ”¥ GRN Tracking
  grnId String?
  grn   GoodsReceivingNote? @relation("GRNStockHistory", fields: [grnId], references: [id])

  batchNumber String? // Track which batch this movement relates to

  movementType MovementType
  sourceType   SourceType
  sourceId     String?
  request      Request?     @relation(fields: [sourceId], references: [id])

  qtyBefore Decimal @db.Decimal(12, 3)
  qtyChange Decimal @db.Decimal(12, 3)
  qtyAfter  Decimal @db.Decimal(12, 3)

  unitPrice Decimal? @db.Decimal(12, 2)

  // ðŸ”¥ Cost & Valuation
  costAtTransaction Decimal?         @db.Decimal(12, 2) // Cost at time of this transaction
  valuationMethod   ValuationMethod? // Method used for this transaction

  notes String? @db.Text

  createdByAdminId    String?
  createdByAdmin      Admin?    @relation(fields: [createdByAdminId], references: [id])
  createdByEmployeeId String?
  createdByEmployee   Employee? @relation(fields: [createdByEmployeeId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ParentFishPool {
  id             String    @id @default(uuid())
  name           String    @unique
  description    String?
  numberOfFishes Int?
  employeeId     String? // âœ… foreign key to Employee
  employee       Employee? @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  parentWaterChanging  ParentWaterChanging[]
  ParentFishFeeding    ParentFishFeeding[]
  ParentFishMedication ParentFishMedication[]
  parentEggMigration   ParentEggMigration[]
}

model Medicine {
  id           String     @id @default(uuid())
  name         String // e.g. "Oxytetracycline"
  description  String? // Details about the medicine
  dosageForm   DosageForm // e.g. LIQUID, POWDER, TABLET
  quantity     Float // Total amount in stock
  unit         String // e.g. "ml", "g", "kg", "bottle"
  purchaseDate DateTime?
  expiryDate   DateTime?
  pricePerUnit Float?
  totalCost    Float?

  addedById String?
  employee  Employee? @relation(fields: [addedById], references: [id], onDelete: SetNull, onUpdate: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  ParentFishMedication ParentFishMedication[]
  EggFishMedication    EggFishMedication[]
  PondMedication       PondMedication[]
}

enum DosageForm {
  LIQUID
  POWDER
  TABLET
  CAPSULE
  OTHER
}

model FeedStock {
  id                  String                @id @default(uuid())
  name                String
  quantity            Int                   @default(0)
  lowStockLevel       Int?                  @default(1)
  category            String?
  createdAt           DateTime              @default(now())
  updatedAt           DateTime              @updatedAt
  eggFishFeeding      EggFishFeeding[]
  ParentFishFeeding   ParentFishFeeding[]
  grownEggPondFeeding GrownEggPondFeeding[]
  feedCage            FeedCage[]
}

model ParentFishFeeding {
  id               String         @id @default(uuid())
  parentFishPool   ParentFishPool @relation(fields: [parentFishPoolId], references: [id])
  parentFishPoolId String
  feed             FeedStock      @relation(fields: [feedId], references: [id])
  feedId           String
  employee         Employee       @relation(fields: [employeeId], references: [id])
  employeeId       String
  quantity         Int            @default(0)
  createdAt        DateTime       @default(now())
}

model ParentWaterChanging {
  id            String         @id @default(uuid())
  parentPoolId  String
  parentPool    ParentFishPool @relation(fields: [parentPoolId], references: [id], onDelete: Cascade)
  employeeId    String
  employee      Employee       @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  date          DateTime       @default(now()) // when the water change happened
  litersChanged Float // âœ… liters of water changed
  description   String? // optional notes
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
}

model ParentFishMedication {
  id               String         @id @default(uuid())
  parentFishPool   ParentFishPool @relation(fields: [parentFishPoolId], references: [id])
  parentFishPoolId String
  medication       Medicine       @relation(fields: [medicationId], references: [id])
  medicationId     String
  employee         Employee       @relation(fields: [employeeId], references: [id])
  employeeId       String
  quantity         Int            @default(0)
  createdAt        DateTime       @default(now())
}

model LaboratoryBox {
  id                 String                       @id @default(uuid())
  name               String                       @unique
  code               String                       @unique
  description        String?
  createdAt          DateTime                     @default(now())
  parentEggMigration ParentEggMigration[]
  BoxWaterChanging   LaboratoryBoxWaterChanging[]
}

enum ParentEggMigrationStatus {
  ACTIVE
  COMPLETED
  DISCARDED
}

model ParentEggMigration {
  id String @id @default(uuid())

  parentPoolId String
  parentPool   ParentFishPool @relation(fields: [parentPoolId], references: [id], onDelete: Cascade)

  laboratoryBoxId String
  laboratoryBox   LaboratoryBox @relation(fields: [laboratoryBoxId], references: [id], onDelete: Cascade)

  employeeId String
  employee   Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  status ParentEggMigrationStatus @default(ACTIVE) // âœ… Default is ACTIVE

  date        DateTime @default(now())
  description String?

  eggFishFeeding     EggFishFeeding[]
  EggFishMedication  EggFishMedication[]
  eggToPondMigration EggToPondMigration[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model EggFishFeeding {
  id                   String             @id @default(uuid())
  parentEggMigrationId String
  parentEggMigration   ParentEggMigration @relation(fields: [parentEggMigrationId], references: [id])
  feed                 FeedStock          @relation(fields: [feedId], references: [id])
  feedId               String
  employee             Employee           @relation(fields: [employeeId], references: [id])
  employeeId           String
  quantity             Int                @default(0)
  createdAt            DateTime           @default(now())
}

model EggFishMedication {
  id                   String             @id @default(uuid())
  ParentEggMigration   ParentEggMigration @relation(fields: [parentEggMigrationId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  parentEggMigrationId String
  medication           Medicine           @relation(fields: [medicationId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  medicationId         String
  employee             Employee           @relation(fields: [employeeId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  employeeId           String
  quantity             Int                @default(0)
  createdAt            DateTime           @default(now())
}

model LaboratoryBoxWaterChanging {
  id            String        @id @default(uuid())
  boxId         String
  laboratoryBox LaboratoryBox @relation(fields: [boxId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  employeeId    String
  employee      Employee      @relation(fields: [employeeId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  litersChanged Float // âœ… liters of water changed
  description   String? // optional notes
  createdAt     DateTime      @default(now())
}

model EggToPondMigration {
  id String @id @default(uuid())

  parentEggMigrationId String
  parentEggMigration   ParentEggMigration @relation(fields: [parentEggMigrationId], references: [id], onDelete: Cascade)

  pondId String
  pond   GrownEggPond @relation(fields: [pondId], references: [id], onDelete: Cascade)

  employeeId String
  employee   Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  date        DateTime @default(now())
  description String?

  status EggToPondStatus @default(ACTIVE)

  grownEggPondFeeding GrownEggPondFeeding[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // relations

  PondWaterChanging PondWaterChanging[]
  PondMedication    PondMedication[]
}

enum EggToPondStatus {
  ACTIVE
  COMPLETED
  DISCARDED
}

model PondWaterChanging {
  id                 String             @id @default(uuid())
  EggtoPondId        String
  eggToPondMigration EggToPondMigration @relation(fields: [EggtoPondId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  employeeId         String
  employee           Employee           @relation(fields: [employeeId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  litersChanged      Float // âœ… liters of water changed
  description        String? // optional notes
  createdAt          DateTime           @default(now())
}

model PondMedication {
  id                 String             @id @default(uuid())
  eggToPondMigration EggToPondMigration @relation(fields: [eggtoPondId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  eggtoPondId        String
  medication         Medicine           @relation(fields: [medicationId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  medicationId       String
  employee           Employee           @relation(fields: [employeeId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  employeeId         String
  quantity           Int                @default(0)
  createdAt          DateTime           @default(now())
}

model GrownEggPond {
  id          String   @id @default(uuid())
  name        String   @unique
  code        String?
  size        Float?
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  EggToPondMigrations EggToPondMigration[]
}

model GrownEggPondFeeding {
  id                   String             @id @default(uuid())
  eggToPondMigrationId String
  eggToPondMigration   EggToPondMigration @relation(fields: [eggToPondMigrationId], references: [id])

  feed       FeedStock @relation(fields: [feedId], references: [id])
  feedId     String
  employee   Employee  @relation(fields: [employeeId], references: [id])
  employeeId String
  quantity   Int       @default(0)
  createdAt  DateTime  @default(now())
}

model Category {
  id          String  @id @default(uuid())
  name        String?
  description String?
  adminId     String?
  employeeId  String?

  admin     Admin?    @relation(fields: [adminId], references: [id])
  employee  Employee? @relation(fields: [employeeId], references: [id])
  createdAt DateTime  @default(now())

  Stock Stock[]
}

// ============================================
// ðŸ”¥ PURCHASE ORDER & GRN SYSTEM
// ============================================

// Supplier Management
model Supplier {
  id            String  @id @default(uuid())
  code          String // Supplier code (e.g., SUP-001)
  name          String
  contactPerson String?
  email         String?
  phone         String?
  address       String? @db.Text
  city          String?
  country       String? @default("Rwanda")

  // Payment & Terms
  paymentTerms String? // e.g., "Net 30", "COD"
  creditLimit  Decimal? @db.Decimal(14, 2)
  taxId        String? // Tax ID / TIN

  // Performance Metrics
  rating            Float? @default(0) // 0-5 star rating
  onTimeDeliveryPct Float? @default(0) // Percentage
  qualityScore      Float? @default(0) // 0-100

  // Status
  status SupplierStatus @default(ACTIVE)
  notes  String?        @db.Text

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  Admin     Admin?   @relation(fields: [adminId], references: [id])
  adminId   String?

  // Relations
  purchaseOrders PurchaseOrder[]
  grns           GoodsReceivingNote[] @relation("SupplierGRNs")
  documents      DocumentAttachment[] @relation("SupplierDocuments")

  @@index([code])
  @@index([name])
  @@unique([code, adminId])
}

enum SupplierStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
}

// Purchase Order
model PurchaseOrder {
  id       String @id @default(uuid())
  poNumber String @unique // Auto-generated: PO-2026-02-0001

  // Supplier
  supplierId String
  supplier   Supplier @relation(fields: [supplierId], references: [id])

  // Dates
  orderDate            DateTime  @default(now())
  expectedDeliveryDate DateTime?

  // Status
  status POStatus @default(DRAFT)

  // Financial
  subtotal     Decimal @default(0) @db.Decimal(14, 2)
  taxAmount    Decimal @default(0) @db.Decimal(14, 2)
  shippingCost Decimal @default(0) @db.Decimal(14, 2)
  otherCharges Decimal @default(0) @db.Decimal(14, 2)
  grandTotal   Decimal @default(0) @db.Decimal(14, 2)

  // Terms & Notes
  paymentTerms  String?
  deliveryTerms String?
  notes         String? @db.Text
  internalNotes String? @db.Text

  // Created By
  createdByAdminId    String?
  createdByAdmin      Admin?    @relation("POCreatedByAdmin", fields: [createdByAdminId], references: [id])
  createdByEmployeeId String?
  createdByEmployee   Employee? @relation("POCreatedByEmployee", fields: [createdByEmployeeId], references: [id])

  // Approved By
  approvedAt           DateTime?
  approvedByAdminId    String?
  approvedByAdmin      Admin?    @relation("POApprovedByAdmin", fields: [approvedByAdminId], references: [id])
  approvedByEmployeeId String?
  approvedByEmployee   Employee? @relation("POApprovedByEmployee", fields: [approvedByEmployeeId], references: [id])

  // Closed/Cancelled
  closedAt           DateTime?
  cancelledAt        DateTime?
  cancellationReason String?   @db.Text

  // Relations
  items     PurchaseOrderItem[]
  grns      GoodsReceivingNote[]
  approvals ApprovalWorkflow[]
  documents DocumentAttachment[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([poNumber])
  @@index([supplierId])
  @@index([status])
}

enum POStatus {
  DRAFT
  PENDING_APPROVAL
  APPROVED
  PARTIALLY_RECEIVED
  RECEIVED
  CLOSED
  CANCELLED
}

// Purchase Order Line Items
model PurchaseOrderItem {
  id String @id @default(uuid())

  purchaseOrderId String
  purchaseOrder   PurchaseOrder @relation(fields: [purchaseOrderId], references: [id], onDelete: Cascade)

  // Product Info
  productName String
  productSku  String?
  description String? @db.Text

  // Quantities
  orderedQty   Decimal @db.Decimal(12, 3)
  receivedQty  Decimal @default(0) @db.Decimal(12, 3)
  remainingQty Decimal @default(0) @db.Decimal(12, 3)

  unit String // e.g., PCS, KG, LITERS

  // Pricing
  unitPrice      Decimal @db.Decimal(12, 2)
  discountPct    Decimal @default(0) @db.Decimal(5, 2)
  discountAmount Decimal @default(0) @db.Decimal(12, 2)
  taxPct         Decimal @default(0) @db.Decimal(5, 2)
  taxAmount      Decimal @default(0) @db.Decimal(12, 2)
  lineTotal      Decimal @default(0) @db.Decimal(14, 2)

  // Status
  status POItemStatus @default(PENDING)

  // Relations
  grnItems GRNItem[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([purchaseOrderId])
}

enum POItemStatus {
  PENDING
  PARTIALLY_RECEIVED
  RECEIVED
  CANCELLED
}

// Goods Receiving Note (GRN)
model GoodsReceivingNote {
  id        String @id @default(uuid())
  grnNumber String @unique // Auto-generated: GRN-2026-02-0001

  // Purchase Order Reference
  purchaseOrderId String
  purchaseOrder   PurchaseOrder @relation(fields: [purchaseOrderId], references: [id])

  // Supplier
  supplierId String
  supplier   Supplier @relation("SupplierGRNs", fields: [supplierId], references: [id])

  // Dates
  receivedDate DateTime @default(now())

  // Received By
  receivedByAdminId    String?
  receivedByAdmin      Admin?    @relation("GRNReceivedByAdmin", fields: [receivedByAdminId], references: [id])
  receivedByEmployeeId String?
  receivedByEmployee   Employee? @relation("GRNReceivedByEmployee", fields: [receivedByEmployeeId], references: [id])

  // Inspection
  inspectionStatus InspectionStatus @default(PENDING)
  inspectionDate   DateTime?
  inspectionNotes  String?          @db.Text
  qualityNotes     String?          @db.Text

  // Discrepancies
  hasDiscrepancies Boolean @default(false)
  discrepancyNotes String? @db.Text

  // Status
  status GRNStatus @default(PENDING)

  // Approved By
  approvedAt           DateTime?
  approvedByAdminId    String?
  approvedByAdmin      Admin?    @relation("GRNApprovedByAdmin", fields: [approvedByAdminId], references: [id])
  approvedByEmployeeId String?
  approvedByEmployee   Employee? @relation("GRNApprovedByEmployee", fields: [approvedByEmployeeId], references: [id])

  // Relations
  items          GRNItem[]
  costBreakdowns CostBreakdown[]
  stockHistory   StockHistory[]       @relation("GRNStockHistory")
  approvals      ApprovalWorkflow[]
  documents      DocumentAttachment[]
  alerts         AlertNotification[]

  notes String? @db.Text

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([grnNumber])
  @@index([purchaseOrderId])
  @@index([supplierId])
}

enum InspectionStatus {
  PENDING
  INSPECTED
  APPROVED
  REJECTED
}

enum GRNStatus {
  PENDING
  APPROVED
  REJECTED
  PARTIALLY_APPROVED
}

// GRN Line Items
model GRNItem {
  id String @id @default(uuid())

  grnId String
  grn   GoodsReceivingNote @relation(fields: [grnId], references: [id], onDelete: Cascade)

  // PO Item Reference
  poItemId String?
  poItem   PurchaseOrderItem? @relation(fields: [poItemId], references: [id])

  // Product Info
  productName String
  productSku  String?
  description String? @db.Text

  // Quantities
  orderedQty  Decimal @db.Decimal(12, 3)
  receivedQty Decimal @db.Decimal(12, 3)
  acceptedQty Decimal @db.Decimal(12, 3)
  rejectedQty Decimal @default(0) @db.Decimal(12, 3)

  unit String

  // Batch Tracking
  batchNumber       String?
  serialNumbers     Json? // Array of serial numbers for serialized items
  manufacturingDate DateTime?
  expiryDate        DateTime?

  // Costing
  unitCost   Decimal  @db.Decimal(12, 2)
  landedCost Decimal? @db.Decimal(12, 2) // Actual cost after all charges
  lineTotal  Decimal  @db.Decimal(14, 2)

  // Location
  locationId String?
  location   StockLocation? @relation(fields: [locationId], references: [id])

  // Quality
  qualityStatus QualityStatus @default(ACCEPTED)
  qualityNotes  String?       @db.Text
  damageNotes   String?       @db.Text

  // Link to StockIn (auto-created)
  stockInId String?  @unique
  stockIn   StockIn? @relation("StockInGRNItem", fields: [stockInId], references: [id])

  // Relations
  batches BatchTracking[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([grnId])
  @@index([batchNumber])
}

enum QualityStatus {
  ACCEPTED
  REJECTED
  PENDING_INSPECTION
  CONDITIONALLY_ACCEPTED
}

// Batch / Lot / Serial Tracking
model BatchTracking {
  id            String  @id @default(uuid())
  batchNumber   String  @unique
  lotNumber     String?
  serialNumbers Json? // Array for individual tracking

  // Product Reference
  productName String
  productSku  String?

  // GRN Reference
  grnItemId String?
  grnItem   GRNItem? @relation(fields: [grnItemId], references: [id])

  // Dates
  manufacturingDate DateTime?
  expiryDate        DateTime?
  receivedDate      DateTime  @default(now())

  // Quantities
  initialQty  Decimal @db.Decimal(12, 3)
  currentQty  Decimal @db.Decimal(12, 3)
  consumedQty Decimal @default(0) @db.Decimal(12, 3)

  unit String

  // Status
  status BatchStatus @default(ACTIVE)

  // Supplier Batch Reference
  supplierBatchRef String?

  // Location
  locationId String?
  location   StockLocation? @relation(fields: [locationId], references: [id])

  notes String? @db.Text

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([batchNumber])
  @@index([expiryDate])
}

enum BatchStatus {
  ACTIVE
  EXPIRED
  RECALLED
  DEPLETED
  QUARANTINED
}

// Cost Breakdown (Landed Cost)
model CostBreakdown {
  id String @id @default(uuid())

  grnId String
  grn   GoodsReceivingNote @relation(fields: [grnId], references: [id], onDelete: Cascade)

  // Cost Components
  baseCost        Decimal @db.Decimal(14, 2) // Purchase price Ã— qty
  shippingCost    Decimal @default(0) @db.Decimal(14, 2)
  customsDuties   Decimal @default(0) @db.Decimal(14, 2)
  insurance       Decimal @default(0) @db.Decimal(14, 2)
  handlingCharges Decimal @default(0) @db.Decimal(14, 2)
  otherFees       Decimal @default(0) @db.Decimal(14, 2)

  // Total
  totalLandedCost Decimal @db.Decimal(14, 2)
  costPerUnit     Decimal @db.Decimal(12, 2)

  // Quantity
  totalQuantity Decimal @db.Decimal(12, 3)

  notes String? @db.Text

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([grnId])
}

// Stock Location / Warehouse
model StockLocation {
  id   String @id @default(uuid())
  code String @unique // e.g., WH-A-01-B-03 (Warehouse A, Aisle 01, Bin 03)
  name String

  // Type
  type LocationType

  // Hierarchy (for nested locations)
  parentId String?
  parent   StockLocation?  @relation("LocationHierarchy", fields: [parentId], references: [id])
  children StockLocation[] @relation("LocationHierarchy")

  // Capacity
  capacityLimit      Decimal? @db.Decimal(12, 3)
  currentUtilization Decimal  @default(0) @db.Decimal(12, 3)

  // Manager
  managerId String?
  manager   Employee? @relation(fields: [managerId], references: [id])

  // Status
  status LocationStatus @default(ACTIVE)

  // Address (for warehouses)
  address String? @db.Text
  city    String?
  country String?

  // Relations
  grnItems GRNItem[]
  batches  BatchTracking[]

  notes String? @db.Text

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([code])
  @@index([type])
}

enum LocationType {
  WAREHOUSE
  STORE
  AISLE
  SHELF
  BIN
  ZONE
}

enum LocationStatus {
  ACTIVE
  INACTIVE
  FULL
  MAINTENANCE
}

// Approval Workflow
model ApprovalWorkflow {
  id String @id @default(uuid())

  // Document Reference
  documentType ApprovalDocType
  documentId   String

  // Purchase Order
  purchaseOrderId String?
  purchaseOrder   PurchaseOrder? @relation(fields: [purchaseOrderId], references: [id])

  // GRN
  grnId String?
  grn   GoodsReceivingNote? @relation(fields: [grnId], references: [id])

  // Requested By
  requestedByAdminId    String?
  requestedByAdmin      Admin?    @relation("ApprovalRequestedByAdmin", fields: [requestedByAdminId], references: [id])
  requestedByEmployeeId String?
  requestedByEmployee   Employee? @relation("ApprovalRequestedByEmployee", fields: [requestedByEmployeeId], references: [id])

  // Approval Level
  approvalLevel     Int     @default(1) // Multi-level approval
  currentApproverId String? // Current person who needs to approve

  // Status
  status ApprovalStatus @default(PENDING)

  // Decision
  approvedAt           DateTime?
  approvedByAdminId    String?
  approvedByAdmin      Admin?    @relation("ApprovalApprovedByAdmin", fields: [approvedByAdminId], references: [id])
  approvedByEmployeeId String?
  approvedByEmployee   Employee? @relation("ApprovalApprovedByEmployee", fields: [approvedByEmployeeId], references: [id])

  rejectedAt      DateTime?
  rejectionReason String?   @db.Text

  // Hierarchy (JSON of approval chain)
  approvalHierarchy Json? // [{level: 1, role: "Manager", approved: true}, ...]

  comments String? @db.Text

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([documentType, documentId])
  @@index([status])
}

enum ApprovalDocType {
  PURCHASE_ORDER
  GRN
  STOCK_ADJUSTMENT
  RETURN
}

enum ApprovalStatus {
  PENDING
  APPROVED
  REJECTED
  ESCALATED
}

// Document Attachments
model DocumentAttachment {
  id String @id @default(uuid())

  // Reference
  referenceType DocRefType
  referenceId   String

  // Purchase Order
  purchaseOrderId String?
  purchaseOrder   PurchaseOrder? @relation(fields: [purchaseOrderId], references: [id], onDelete: Cascade)

  // GRN
  grnId String?
  grn   GoodsReceivingNote? @relation(fields: [grnId], references: [id], onDelete: Cascade)

  // Supplier
  supplierId String?
  supplier   Supplier? @relation("SupplierDocuments", fields: [supplierId], references: [id], onDelete: Cascade)

  // Document Info
  documentType DocumentType
  fileName     String
  fileUrl      String // Storage path or URL
  fileSize     Int // Bytes
  mimeType     String?

  // Metadata
  title       String?
  description String? @db.Text

  // Uploaded By
  uploadedByAdminId    String?
  uploadedByAdmin      Admin?    @relation("DocUploadedByAdmin", fields: [uploadedByAdminId], references: [id])
  uploadedByEmployeeId String?
  uploadedByEmployee   Employee? @relation("DocUploadedByEmployee", fields: [uploadedByEmployeeId], references: [id])

  uploadedAt DateTime @default(now())

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([referenceType, referenceId])
}

enum DocRefType {
  PURCHASE_ORDER
  GRN
  SUPPLIER
  PRODUCT
}

enum DocumentType {
  INVOICE
  DELIVERY_NOTE
  PACKING_LIST
  QUALITY_CERTIFICATE
  PHOTO
  CONTRACT
  OTHER
}

// Alert & Notification System
model AlertNotification {
  id String @id @default(uuid())

  // Alert Type
  alertType AlertType
  severity  AlertSeverity @default(INFO)

  // Reference
  referenceType String?
  referenceId   String?

  // GRN Reference
  grnId String?
  grn   GoodsReceivingNote? @relation(fields: [grnId], references: [id])

  // Message
  title   String
  message String @db.Text

  // Status
  isRead                   Boolean   @default(false)
  acknowledgedAt           DateTime?
  acknowledgedByAdminId    String?
  acknowledgedByAdmin      Admin?    @relation("AlertAcknowledgedByAdmin", fields: [acknowledgedByAdminId], references: [id])
  acknowledgedByEmployeeId String?
  acknowledgedByEmployee   Employee? @relation("AlertAcknowledgedByEmployee", fields: [acknowledgedByEmployeeId], references: [id])

  actionTaken String? @db.Text

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([alertType])
  @@index([isRead])
}

enum AlertType {
  OVER_DELIVERY
  UNDER_DELIVERY
  EXPIRED_PRODUCT
  QUALITY_ISSUE
  APPROVAL_REQUIRED
  LOW_STOCK
  PRICE_VARIANCE
  MISSING_ITEMS
  DAMAGED_GOODS
}

enum AlertSeverity {
  INFO
  WARNING
  CRITICAL
  URGENT
}

enum ExpenseType {
  DEBIT
  CREDIT
}

model Expense {
  id            String      @id @unique @default(uuid())
  title         String
  description   String?     @db.Text
  amount        Decimal     @db.Decimal(10, 2)
  category      String?
  date          DateTime
  paymentMethod String?
  type          ExpenseType @default(DEBIT)
  
  adminId       String
  admin         Admin       @relation(fields: [adminId], references: [id], onDelete: Cascade)

  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
}
